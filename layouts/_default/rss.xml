{{/* 
# Patch – Datei: layouts/_default/rss.xml
# Typ: Update
# Ursache: XML wurde HTML-escaped (Feed enthielt &lt;?xml ...)
# Lösung: safeHTML + korrektes Outputformat + valides RSS-Template
# Ergebnis: W3C-valider RSS-Feed (UTF-8, kein HTML-Escaping)
*/}}

{{- printf "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" | safeHTML -}}
<rss version="2.0"
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xmlns:content="http://purl.org/rss/1.0/modules/content/"
  xmlns:atom="http://www.w3.org/2005/Atom">

  <channel>
    <title>{{ .Site.Title }}</title>
    <link>{{ .Site.BaseURL }}</link>
    <description>{{ .Site.Params.description }}</description>
    <language>{{ .Site.LanguageCode | default "de-de" }}</language>
    <generator>Hugo {{ hugo.Version }}</generator>
    <lastBuildDate>{{ now.Format "Mon, 02 Jan 2006 15:04:05 MST" }}</lastBuildDate>
    <atom:link href="{{ .Site.BaseURL }}index.xml" rel="self" type="application/rss+xml"/>

    {{- $pages := where .Site.RegularPages "Type" "in" site.Params.mainSections -}}
    {{- range first 20 (sort $pages "Date" "desc") }}
      <item>
        <title>{{ .Title | htmlEscape }}</title>
        <link>{{ .Permalink }}</link>
        <guid>{{ .Permalink }}</guid>
        <pubDate>{{ .Date.Format "Mon, 02 Jan 2006 15:04:05 MST" }}</pubDate>
        <description><![CDATA[
{{ if .Params.summary -}}
{{ .Params.summary }}
{{ else if .Summary -}}
{{ .Summary }}
{{ else -}}
{{ .Plain | truncate 300 }}
{{ end -}}
        ]]></description>
      </item>
    {{- end }}

  </channel>
</rss>